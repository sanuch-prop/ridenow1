<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <!-- отключаем авто-зум и учитываем «чёлку» -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Вход — RideNow</title>
  <style>
    :root{
      --glass-1: rgba(14,21,26,.55);
      --glass-2: rgba(14,21,26,.35);
      --ink:#f3f7ff; --muted:#c4ceda; --stroke:rgba(255,255,255,.18);
      --accent:#ffb668; --accent-2:#9de9d7;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55) 35%, rgba(0,0,0,.45) 60%, rgba(0,0,0,.55)),
        url("image.png") center/cover no-repeat fixed;
      -webkit-text-size-adjust:100%;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      /* убираем прокрутку у страницы */
      overflow:hidden;
    }

    /* Центрирование: карточка всегда по центру и тянется по высоте экрана */
    .app{
      min-height:100dvh;
      display:grid;
      place-items:center;
      padding:12px;
      padding-bottom:calc(12px + env(safe-area-inset-bottom));
    }
    .card{
      width:min(760px,96vw);
      min-height:clamp(540px, 84dvh, 92dvh); /* растягиваем, но не на 100% */
      border-radius:22px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg,var(--glass-1),var(--glass-2));
      box-shadow:0 24px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.25);
      backdrop-filter: blur(16px) saturate(140%);
      display:flex;
      flex-direction:column;
      padding:16px;
    }
    /* Внутри карточки выравниваем контент по центру — без скролла */
    .inner{
      width:min(640px,100%);
      margin:0 auto;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .brand{display:flex;align-items:center;gap:8px;font-weight:900;opacity:.95;margin-bottom:6px}
    .brand .dot{width:8px;height:8px;border-radius:999px;background:#58e0ff;display:inline-block}
    h1{margin:8px 0 14px;font-size:24px}

    /* Роль */
    .role-tabs{display:flex;gap:8px;margin-bottom:12px}
    .role-btn{
      flex:1; padding:12px 12px; border-radius:12px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
      color:var(--ink); font-weight:800; cursor:pointer;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.25);
    }
    .role-btn.is-active{
      border:none; color:#0b0f12;
      background:linear-gradient(180deg,var(--accent),var(--accent-2));
      box-shadow:0 10px 20px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.6);
    }

    /* Соцкнопки */
    .social{display:grid;gap:8px;margin:10px 0}
    .sbtn{
      display:flex;align-items:center;gap:10px;justify-content:center;
      border:1px solid var(--stroke); border-radius:12px; padding:12px 14px;
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
      color:var(--ink); font-weight:800; cursor:pointer;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.25);
    }
    .icon{width:18px;height:18px;border-radius:4px;background:#fff;display:inline-block}
    .icon.g{background:#fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="%234285F4" d="M24 9.5c3.2 0 6.1 1.1 8.4 3.2l6.3-6.3C34.8 2.3 29.7 0 24 0 14.6 0 6.5 5.4 2.5 13.3l7.4 5.7C12 13.4 17.5 9.5 24 9.5z"/><path fill="%2334A853" d="M46.5 24.5c0-1.6-.2-3.1-.6-4.5H24v9h12.7c-.6 3-2.4 5.6-5.1 7.3l7.9 6.1c4.6-4.2 7-10.4 7-17.9z"/><path fill="%23FBBC05" d="M9.9 28.9c-.5-1.5-.8-3.1-.8-4.9s.3-3.4.8-4.9L2.5 13.3C.9 16.6 0 20.2 0 24c0 3.8.9 7.4 2.5 10.7l7.4-5.8z"/><path fill="%23EA4335" d="M24 48c6.5 0 12-2.1 16.1-5.8l-7.9-6.1c-2.2 1.5-5.1 2.4-8.2 2.4-6.5 0-12-3.9-14-9.1l-7.4 5.8C6.5 42.6 14.6 48 24 48z"/></svg>') center/cover no-repeat}
    .icon.a{background:#000}

    .sep{margin:6px 0;color:var(--muted);text-align:center}

    /* Поля/кнопки — анти-зум */
    .field{margin:8px 0}
    .input{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.08); color:var(--ink); font-weight:700;
      font-size:16px; /* ключ: 16px+ исключает авто-зум iOS */
      outline:none;
    }
    .input:focus{box-shadow:0 0 0 2px rgba(255,255,255,.18) inset}
    .helpers{display:flex;justify-content:space-between;align-items:center;margin:6px 0;color:var(--muted)}
    .helpers a{color:#ffd59b;text-decoration:none}

    .cta{
      width:100%; margin-top:8px; padding:12px 16px; border:none; cursor:pointer; border-radius:14px; font-weight:900;
      background:linear-gradient(180deg,var(--accent),var(--accent-2)); color:#0b0f12;
      box-shadow:0 10px 22px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.6);
    }
    .legal,.bottom{margin-top:8px;color:var(--muted);text-align:center}
    .bottom a{color:#ffd59b;text-decoration:none}

    /* Модалка соцлогина */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;z-index:999}
    .hidden{display:none}
    .modal-card{
      width:min(520px,92vw);
      border-radius:16px; padding:16px;
      background:linear-gradient(180deg,var(--glass-1),var(--glass-2));
      border:1px solid var(--stroke);
      box-shadow:0 24px 60px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.25);
      color:var(--ink);
    }
    .modal-card h2{margin:0 0 8px}
    .auth-actions{display:flex;gap:8px;margin-top:10px}
    .continue-btn{
      flex:1; padding:10px 12px; border-radius:12px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));
      color:var(--ink); font-weight:800; cursor:pointer;
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="card" role="dialog" aria-labelledby="title">
      <div class="inner">
        <div class="brand"><span class="dot"></span><span>RideNow</span></div>
        <h1 id="title">Вход</h1>

        <!-- Выбор роли -->
        <nav class="role-tabs" aria-label="Выбор роли">
          <button class="role-btn is-active" type="button" data-role="passenger">Я пассажир</button>
          <button class="role-btn" type="button" data-role="driver">Я водитель</button>
        </nav>

        <!-- Соцсети -->
        <div class="social" aria-label="Войти через">
          <button class="sbtn" type="button"><span class="icon g"></span>Войти через Google</button>
          <button class="sbtn" type="button"><span class="icon a"></span>Войти через Apple</button>
        </div>

        <div class="sep">или по email</div>

        <label class="field" for="email">
          <input id="email" class="input" type="email" placeholder="email@example.com"
                 autocomplete="email" inputmode="email">
        </label>
        <label class="field" for="pass">
          <input id="pass" class="input" type="password" placeholder="Пароль"
                 autocomplete="current-password">
        </label>

        <div class="helpers">
          <label><input type="checkbox" checked> Запомнить меня</label>
          <a href="#" id="restoreLink">Забыли пароль?</a>
        </div>

        <button class="cta" type="button" id="loginBtn">Войти</button>

        <div class="legal">Нажимая «Войти», принимаю <a href="#" class="policyLink">Условия</a> и <a href="#" class="policyLink">Политику</a>.</div>
        <div class="bottom">Нет аккаунта? <a href="#" id="createLink">Создать</a></div>
      </div>
    </section>
  </main>

  <!-- Модалка авторизации -->
  <div class="modal hidden" id="authModal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-labelledby="authTitle" aria-describedby="authStatus">
      <h2 id="authTitle">Вход через Google…</h2>
      <p id="authStatus">Подождите, выполняем вход…</p>
      <div class="auth-actions hidden" id="authActions"><button class="continue-btn passenger">Продолжить как пассажир</button>
        <button class="continue-btn driver">Продолжить как водитель</button>
      </div>
    </div>
  </div>

  <script>
    // ===== helpers
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const profileRaw = localStorage.getItem('ridenow_profile');
    const profile = profileRaw ? JSON.parse(profileRaw) : null;

    // ===== выбор роли (запоминаем)
    const roleButtons = $$('.role-btn');
    let selectedRole = 'passenger';
    function setActiveRole(role){
      selectedRole = role;
      roleButtons.forEach(b=>b.classList.toggle('is-active', b.dataset.role===role));
      localStorage.setItem('lastRole', role);
    }
    const last = localStorage.getItem('lastRole');
    if (last === 'driver' || last === 'passenger') setActiveRole(last);
    roleButtons.forEach(btn => btn.addEventListener('click', () => setActiveRole(btn.dataset.role)));

    // ===== маршрутизация
    function routeFor(role){
      if (profile && (!profile.role || profile.role === role)) {
        return role === 'driver' ? 'profile-driver.html' : 'profile-passenger.html';
      }
      const qs = role === 'driver' ? '?role=driver' : '?role=passenger';
      return 'register.html' + qs;
    }

    // ===== обычный вход
    $('#loginBtn').addEventListener('click', () => { window.location.href = routeFor(selectedRole); });

    // ===== ссылки
    $('#restoreLink').addEventListener('click', e => { e.preventDefault(); window.location.href = 'restore.html'; });
    $('#createLink').addEventListener('click', e => {
      e.preventDefault();
      window.location.href = selectedRole === 'driver' ? 'register.html?role=driver' : 'register.html?role=passenger';
    });
    $$('.policyLink').forEach(l => l.addEventListener('click', e => { e.preventDefault(); window.location.href = 'policy.html'; }));

    // ===== модалка соцлогина (демо)
    const modal = $('#authModal');
    const authTitle = $('#authTitle');
    const authStatus = $('#authStatus');
    const authActions = $('#authActions');

    function openAuthModal(provider) {
      authTitle.textContent =` Вход через ${provider}…`;
      authStatus.textContent = 'Подождите, выполняем вход…';
      authActions.classList.add('hidden');
      modal.classList.remove('hidden');
      modal.setAttribute('aria-hidden', 'false');

      setTimeout(() => {
        authStatus.innerHTML = 'Вход подтверждён ✅';
        authActions.classList.remove('hidden');
      }, 1200);
    }

    document.querySelector('.social .sbtn:nth-child(1)').addEventListener('click', () => openAuthModal('Google'));
    document.querySelector('.social .sbtn:nth-child(2)').addEventListener('click', () => openAuthModal('Apple'));

    // Закрытие модалки по фону/ESC
    modal.addEventListener('click', (e) => {
      if (e.target === modal) { modal.classList.add('hidden'); modal.setAttribute('aria-hidden', 'true'); }
    });
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden'); modal.setAttribute('aria-hidden', 'true');
      }
    });
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no">
<title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–∞–¥–∫–∏ ‚Äî RideNow</title>
<style>
  :root{
    --ink:#eaf2ff; --muted:#a6b5cc; --stroke:rgba(255,255,255,.18);
    --glass-1:rgba(14,21,26,.55); --glass-2:rgba(14,21,26,.35);
    --g1:#ffb668; --g2:#9de9d7; --nav-h:74px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55) 35%, rgba(0,0,0,.45) 60%, rgba(0,0,0,.55)),
      url("image.png") center/cover no-repeat fixed;
    -webkit-text-size-adjust:100%;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    padding:16px;
    padding-bottom:calc(16px + env(safe-area-inset-bottom) + var(--nav-h));
  }

  .card{
    width:min(760px,96vw);
    margin:0 auto;
    border-radius:22px;
    border:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--glass-1),var(--glass-2));
    box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.22);
    backdrop-filter: blur(16px) saturate(140%);
  }
  .inner{ padding:16px 16px 22px }

  .brand{ font-weight:900; letter-spacing:.2px; display:flex; gap:8px; align-items:center; opacity:.95}
  .brand .dot{width:8px;height:8px;border-radius:50%;background:#58e0ff;display:inline-block}
  h1{ margin:8px 0 12px; font-size:26px; letter-spacing:.2px }

  .block{
    margin:12px 0; padding:12px; border-radius:16px;
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    border:1px solid var(--stroke);
  }
  .row{display:flex; align-items:center; gap:12px; justify-content:space-between}
  .sub{color:var(--muted)}
  .pill{
    padding:8px 12px; border-radius:12px; border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    font-weight:800;
  }
  .cta{
    height:50px; border-radius:16px; width:100%; margin-top:8px; border:0; cursor:pointer;
    color:#0b0f12; font-weight:900; font-size:18px; letter-spacing:.2px;
    background:linear-gradient(90deg,var(--g1),var(--g2));
    box-shadow:0 12px 28px rgba(0,0,0,.28);
  }

  /* ===== –ú–û–î–ê–õ–ö–ò (—Ü–µ–Ω—Ç—Ä, –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é) ===== */
  .overlay{position:fixed; inset:0; display:none; place-items:center; z-index:60; padding:16px;
    background:rgba(0,0,0,.35)}
  .overlay.open{display:grid}
  .sheet{
    width:min(620px,94vw);
    border-radius:18px; border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(20,24,32,.92), rgba(20,24,32,.90));
    box-shadow:0 30px 80px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.2);
    backdrop-filter: blur(16px) saturate(160%);
    padding:14px;
    margin-bottom:calc(var(--nav-h) + env(safe-area-inset-bottom));
  }
  .sheet h3{margin:6px 2px 10px}
  .actions{display:flex; gap:10px}
  .btn{flex:1; height:46px; border-radius:14px; border:1px solid var(--stroke);
       background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06)); color:var(--ink); font-weight:800; cursor:pointer}
  .btn.ok{border:0; color:#0b0f12; background:linear-gradient(90deg,var(--g1),var(--g2))}
  .btn.bad{border-color:rgba(255,120,120,.45); color:#ffd6d6}

  /* ===== –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø (–æ–±—â–∞—è) ===== */
  .bottom-shell{position:fixed; left:0; right:0; bottom:0; z-index:55; padding:10px 12px calc(10px + env(safe-area-inset-bottom)); display:grid; place-items:center}
  .bottom-bar{display:flex; gap:10px; align-items:center; justify-content:space-between; padding:10px;
    max-width:760px; width:100%; margin:0 auto; border-radius:18px;
    background:linear-gradient(180deg,rgba(12,12,14,.78),rgba(12,12,14,.62));
    border:1px solid rgba(255,255,255,.2);
    box-shadow:0 18px 44px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.28);
    backdrop-filter: blur(16px) saturate(160%);
  }
  .bn{flex:1; display:grid; justify-items:center; text-decoration:none; color:#e8eef9}
  .bn .ico{font-size:18px; margin-bottom:4px}
  .bn .txt{font-size:12px; color:#cbd4e6; font-weight:800}
  .bn.active{background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06)); border-radius:12px}
  .bn.active .txt{color:#ffd59b}

  /* –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
  .label{font-weight:900; margin-bottom:6px}
  .count{font-weight:900}
  .reason-list{display:grid; gap:8px; margin:8px 0}
  .reason{display:flex; gap:10px; align-items:center;
          padding:10px 12px; border-radius:12px; border:1px solid var(--stroke);
          background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05))}
  textarea{width:100%; min-height:72px; resize:vertical; border-radius:10px; border:1px solid var(--stroke);
           background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)); color:var(--ink); padding:8px}
</style>
</head>
<body>

<main class="card">
  <div class="inner">
    <div class="brand"><span class="dot"></span><span>RideNow</span></div>
    <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–∞–¥–∫–∏</h1>

    <div class="block">
      <div class="label">–ü–æ—Å–∞–¥–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞:</div>
      <div class="row">
        <div>
          <div class="sub">–≤—Ä–µ–º—è</div>
          <div class="pill" id="dep">‚Äî:‚Äî</div>
        </div>
        <div>
          <div class="sub">–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —á–µ—Ä–µ–∑</div>
          <div class="pill"><span id="left" class="count">‚Äî:‚Äî</span></div>
        </div>
      </div>
      <button class="cta" id="demoSoon">–ü–æ–∫–∞–∑–∞—Ç—å –¥–∏–∞–ª–æ–≥ (–¥–µ–º–æ)</button>
      <div class="sub" style="margin-top:6px">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–∞–¥–∫–∏ ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤—ë—Ä–Ω—É—Ç–æ (–ø—Ä–∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö).</div>
    </div>

    <div class="block">
      <div class="label">–ß—Ç–æ –¥–∞–ª—å—à–µ?</div>
      <div class="sub">–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ¬´–î–∞, —è –≤ –ø—É—Ç–∏¬ª –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∂–∏–≤–æ–π –ø–æ–µ–∑–¥–∫–æ–π (–∫–∞—Ä—Ç–∞ –∏ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è). –ï—Å–ª–∏ –Ω–∞–∂–∞—Ç—å ¬´–ù–µ—Ç, –Ω–µ —Å–µ–ª(–∞)¬ª ‚Äî —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º —Ç–∏–∫–µ—Ç —Å –ø—Ä–∏—á–∏–Ω–æ–π –∏ –≤–µ—Ä–Ω—ë–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–π –ø–æ–µ–∑–¥–∫–∏.</div>
    </div>
  </div>
</main>

<!-- –î–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div class="overlay" id="checkDlg" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true" aria-labelledby="checkTitle">
    <h3 id="checkTitle">–í—ã –≤ –ø–æ–µ–∑–¥–∫–µ?</h3>
    <p class="sub" id="checkHint">–ü—Ä–æ—à–ª–æ 30 –º–∏–Ω—É—Ç —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–∞–¥–∫–∏.</p>
    <div class="actions" style="margin-top:10px">
      <button class="btn ok" id="btnYes">–î–∞, —è –≤ –ø—É—Ç–∏</button>
      <button class="btn bad" id="btnNo">–ù–µ—Ç, –Ω–µ —Å–µ–ª(–∞)</button>
    </div>
  </div>
</div>

<!-- –°–æ–æ–±—â–µ–Ω–∏–µ ¬´–•–æ—Ä–æ—à–µ–π –¥–æ—Ä–æ–≥–∏¬ª -->
<div class="overlay" id="greetDlg" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <h3>–û—Ç–ª–∏—á–Ω–æ–≥–æ –ø—É—Ç–∏!</h3>
    <p class="sub">–ü—É—Å—Ç—å –¥–æ—Ä–æ–≥–∞ –∏–¥—ë—Ç –ª–µ–≥–∫–æ, –ø–ª–µ–π–ª–∏—Å—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –∞ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä ‚Äî –±–µ–∑ —Å—é—Ä–ø—Ä–∏–∑–æ–≤.</p>
    <div class="actions" style="margin-top:10px">
      <a class="btn ok" href="trip-next.html">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–µ–∑–¥–∫—É</a>
    </div>
  </div>
</div>

<!-- –¢–∏–∫–µ—Ç –ø—Ä–∏—á–∏–Ω—ã -->
<div class="overlay" id="reasonDlg" aria-hidden="true">
  <div class="sheet" role="dialog" aria-modal="true">
    <h3>–ü–æ—á–µ–º—É –Ω–µ —Å–µ–ª–∏?</h3>
    <div class="reason-list">
      <label class="reason"><input type="radio" name="r" value="late"> –ó–∞–¥–µ—Ä–∂–∞–ª—Å—è(–∞—Å—å)</label>
      <label class="reason"><input type="radio" name="r" value="missed"> –ù–µ –Ω–∞—à—ë–ª(–∞) –≤–æ–¥–∏—Ç–µ–ª—è</label>
      <label class="reason"><input type="radio" name="r" value="change"> –ü–æ–º–µ–Ω—è–ª–∏—Å—å –ø–ª–∞–Ω—ã</label>
      <label class="reason"><input type="radio" name="r" value="other"> –î—Ä—É–≥–æ–µ</label>
    </div>
    <textarea id="details" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
    <div class="actions" style="margin-top:10px">
      <button class="btn" onclick="closeDlg('reasonDlg')">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn ok" id="sendReason">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="bottom-shell" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
  <div class="bottom-bar">
    <a class="bn" href="profile-passenger.html"><div class="ico">üë§</div><div class="txt">–ü—Ä–æ—Ñ–∏–ª—å</div></a><a class="bn" href="wallet.html"><div class="ico">üí≥</div><div class="txt">–ö–æ—à–µ–ª—ë–∫</div></a>
    <a class="bn active" href="trip.html?active=1"><div class="ico">üöó</div><div class="txt">–ê–∫—Ç—É–∞–ª—å–Ω–∞—è</div></a>
    <a class="bn" href="main-passenger.html"><div class="ico">üîç</div><div class="txt">–ü–æ–∏—Å–∫</div></a>
  </div>
</nav>

<script>
  // ===== –ü–ê–†–ê–ú–ï–¢–†–´: –≤—Ä–µ–º—è –ø–æ—Å–∞–¥–∫–∏ –±–µ—Ä—ë–º –∏–∑ query ?board=ISO, –∏–Ω–∞—á–µ –¥–µ–º–æ +1 –º–∏–Ω
  const qs = new URLSearchParams(location.search);
  const boardIso = qs.get('board');
  const boardTime = boardIso ? new Date(boardIso) : new Date(Date.now() + 60*1000);
  const remindAt  = new Date(boardTime.getTime() + 30*60*1000);

  // UI —ç–ª–µ–º–µ–Ω—Ç—ã
  const depEl = document.getElementById('dep');
  const leftEl = document.getElementById('left');
  const checkDlg = document.getElementById('checkDlg');
  const greetDlg = document.getElementById('greetDlg');
  const reasonDlg = document.getElementById('reasonDlg');

  depEl.textContent = boardTime.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit'});

  // ===== –æ–±—Ä–∞—Ç–Ω—ã–π –æ—Ç—Å—á—ë—Ç –¥–æ –ø–æ–∫–∞–∑–∞ –¥–∏–∞–ª–æ–≥–∞
  function tick(){
    const now = new Date();
    const ms = remindAt - now;
    if (ms <= 0){ showCheck(); return; }
    const m = Math.floor(ms/60000), s = Math.floor(ms/1000)%60;
    leftEl.textContent =` ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    requestAnimationFrame(tick);
  }
  tick();

  // ===== –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ)
  if ('Notification' in window){
    if (Notification.permission === 'default'){
      // –Ω–µ –Ω–∞–≤—è–∑—á–∏–≤–æ –ø—Ä–æ—Å–∏–º –¥–æ—Å—Ç—É–ø
      setTimeout(()=> Notification.requestPermission().catch(()=>{}), 1200);
    }
  }
  function pushNotice(){
    if ('Notification' in window && Notification.permission === 'granted'){
      try{
        const n = new Notification('RideNow ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–∞–¥–∫–∏', {
          body:'–í—ã –≤ –ø–æ–µ–∑–¥–∫–µ? –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å.',
          icon:'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAI0lEQVQoU2NkYGD4z0AEYBxVSFQGEQ0wQhGqwRjGQYgA7cQAA1o0iV8Ww3qQAAAABJRU5ErkJggg=='
        });
        n.onclick = ()=>{ window.focus(); showCheck(); n.close(); };
      }catch(e){}
    }
  }

  // ===== –ø–æ–∫–∞–∑ –¥–∏–∞–ª–æ–≥–∞
  function showCheck(){
    checkDlg.classList.add('open');
    pushNotice();
  }
  function closeDlg(id){ document.getElementById(id).classList.remove('open'); }

  // DEMO-–∫–Ω–æ–ø–∫–∞
  document.getElementById('demoSoon').onclick = showCheck;

  // ¬´–î–∞, –≤ –ø—É—Ç–∏¬ª
  document.getElementById('btnYes').onclick = ()=>{
    checkDlg.classList.remove('open');
    greetDlg.classList.add('open');
    // –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–º–µ—Ç–∫—É –æ –ø–æ—Å–∞–¥–∫–µ
    try{ localStorage.setItem('ridenow_checkin', JSON.stringify({at:Date.now(), ok:true})); }catch(_){}
  };

  // ¬´–ù–µ—Ç, –Ω–µ —Å–µ–ª(–∞)¬ª
  document.getElementById('btnNo').onclick = ()=>{
    checkDlg.classList.remove('open');
    reasonDlg.classList.add('open');
  };

  // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏—á–∏–Ω—ã
  document.getElementById('sendReason').onclick = ()=>{
    const v = (document.querySelector('input[name="r"]:checked')||{}).value || 'unspecified';
    const d = document.getElementById('details').value.trim();
    try{ localStorage.setItem('ridenow_no_board', JSON.stringify({at:Date.now(), reason:v, note:d})) }catch(_){}
    // —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—É—é –ø–æ–µ–∑–¥–∫—É
    location.href = 'trip-confirmed.html';
  };
</script>
</body>
</html>
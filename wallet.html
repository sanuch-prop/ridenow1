<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>–ö–æ—à–µ–ª—ë–∫ ‚Äî RideNow</title>
<style>
  :root{
    --ink:#eaf2ff; --muted:#a6b5cc; --stroke:rgba(255,255,255,.18);
    --glass-1:rgba(14,21,26,.55); --glass-2:rgba(14,21,26,.35);
    --g1:#ffb668; --g2:#9de9d7;
    --gutter:16px; --nav-h:92px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:
      linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.55) 35%, rgba(0,0,0,.45) 60%, rgba(0,0,0,.55)),
      url("image.png") center/cover no-repeat fixed;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    padding:var(--gutter);
    padding-bottom:calc(var(--gutter) + env(safe-area-inset-bottom));
    display:flex; flex-direction:column; overflow:hidden;
  }

  main.card{
    width:min(760px, calc(100vw - var(--gutter)*2));
    margin:0 auto;
    border-radius:22px; border:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--glass-1),var(--glass-2));
    box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.22);
    backdrop-filter: blur(16px) saturate(140%);
    max-height:calc(100dvh - var(--nav-h) - 12px - env(safe-area-inset-bottom));
    overflow:auto; -webkit-overflow-scrolling:touch;
  }
  .inner{ padding:16px 16px 18px }
  .brand{font-weight:900;display:flex;gap:8px;align-items:center;opacity:.95}
  .brand .dot{width:8px;height:8px;border-radius:50%;background:#58e0ff}
  h1{margin:8px 0 12px;font-size:26px;letter-spacing:.2px}

  .block{padding:12px;border-radius:16px;border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06)); margin-bottom:12px}

  /* –±–∞–ª–∞–Ω—Å */
  .balance{display:flex;justify-content:space-between;align-items:end;gap:8px}
  .bal-num{font-size:34px;font-weight:900; letter-spacing:.3px}
  .bal-hint{color:var(--muted); font-weight:700}
  .rule{margin-top:8px;color:#cfe3ff}

  /* —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25 */
  .fee-card .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .pill{
    display:inline-grid;place-items:center;white-space:nowrap;
    padding:8px 12px;border-radius:14px;font-weight:900;
    background:linear-gradient(90deg,#b8ff9c,#7dffcf); color:#072e12; border:0;
  }
  .muted{color:#b7c5dc}

  /* —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
  .stats{display:grid;grid-template-columns:1fr 1fr; gap:10px; margin-top:8px}
  .stat{padding:12px;border:1px solid var(--stroke);border-radius:14px;
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06))}
  .stat .big{font-size:24px;font-weight:900}
  .comment{margin-top:8px;font-weight:900}

  /* –∏—Å—Ç–æ—Ä–∏—è */
  .entry{padding:10px;border:1px solid var(--stroke);border-radius:14px;margin-top:10px;
    background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    display:flex;justify-content:space-between;gap:10px;align-items:center}
  .entry .sub{color:#9fb0c9;font-size:13px}
  .empty{color:#9fb0c9}

  /* –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
  .bottom-shell{position:fixed;left:0;right:0;bottom:0;z-index:1000;
    padding:0 env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
  .bottom-bar{display:flex;justify-content:space-around;background:var(--glass-2);
    border-radius:20px 20px 0 0;padding:8px;backdrop-filter:blur(12px)}
  .bn-tab{flex:1;text-align:center;color:var(--ink);font-size:12px;text-decoration:none;padding:6px 0}
  .bn-tab .ico{font-size:18px;display:block}
  .bn-tab.active{color:var(--g1)}
</style>
</head>
<body>
  <main class="card" id="card">
    <div class="inner">
      <div class="brand"><span class="dot"></span><span>RideNow</span></div>
      <h1>–ö–æ—à–µ–ª—ë–∫</h1>

      <!-- –ë–∞–ª–∞–Ω—Å –±–æ–Ω—É—Å–æ–≤ -->
      <section class="block">
        <div class="balance">
          <div>
            <div class="bal-hint">–ë–æ–Ω—É—Å–Ω—ã–π –±–∞–ª–∞–Ω—Å</div>
            <div class="bal-num" id="balance">0 ‚Ç¥</div>
          </div>
          <div class="bal-hint">100 –∫–º ‚Üí 10 ‚Ç¥</div>
        </div>
        <div class="rule">–ó–∞ –∫–∞–∂–¥—ã–µ 100 –∫–º –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–µ–∑–¥–æ–∫ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 10 ‚Ç¥, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Å–∫–∏–¥–∫—É —É –≤–æ–¥–∏—Ç–µ–ª—è.</div>
      </section>

      <!-- –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25: –¥–µ—Ä–∂–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –ø–æ–µ–∑–¥–∫—É -->
      <section class="block fee-card">
        <div class="row">
          <div class="pill" id="feeBadge" style="display:none">–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25 ‚Ç¥ ‚Äî —É–∂–µ –æ–ø–ª–∞—á–µ–Ω</div>
        </div>
        <div class="rule">
          –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –æ–ø–ª–∞—á–µ–Ω–Ω–∞—è –±—Ä–æ–Ω—å –Ω–µ —Å–æ—Å—Ç–æ—è–ª–∞—Å—å (–æ—Ç–º–µ–Ω–∞ –≤–æ–¥–∏—Ç–µ–ª—è/–ø–∞—Å—Å–∞–∂–∏—Ä–∞ –∏–ª–∏ —Ç—ã —Å–º–µ–Ω–∏–ª –ø–æ–µ–∑–¥–∫—É),
          –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä <strong>25 ‚Ç¥</strong> –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–º –µ–≥–æ –∫ —Å–ª–µ–¥—É—é—â–µ–π –±—Ä–æ–Ω–∏.
        </div>
      </section>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <section class="block">
        <div style="font-weight:900">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≥–æ–¥</div>
        <div class="stats">
          <div class="stat">
            <div class="big" id="stTrips">0</div>
            <div class="muted">–ø–æ–µ–∑–¥–æ–∫</div>
          </div>
          <div class="stat">
            <div class="big" id="stKm">0 –∫–º</div>
            <div class="muted">–ø—Ä–æ–π–¥–µ–Ω–æ</div>
          </div>
        </div>
        <div class="comment" id="comment">–ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å! üöó</div>
      </section>

      <!-- –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π -->
      <section class="block">
        <div style="font-weight:900">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</div>
        <div id="history" style="margin-top:6px"></div>
      </section>
    </div>
  </main>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="bottom-shell" id="nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
    <div class="bottom-bar">
      <a class="bn-tab" href="profile-passenger.html"><div class="ico">üë§</div>–ü—Ä–æ—Ñ–∏–ª—å</a>
      <a class="bn-tab active" href="wallet.html"><div class="ico">üí≥</div>–ö–æ—à–µ–ª—ë–∫</a>
      <a class="bn-tab" href="active.html"><div class="ico">üöó</div>–ê–∫—Ç—É–∞–ª—å–Ω–∞—è</a>
      <a class="bn-tab" href="main-passenger.html"><div class="ico">üîç</div>–ü–æ–∏—Å–∫</a>
    </div>
  </nav>

<script>
  // ---- STORAGE KEYS ----
  const LS_BALANCE = 'rn:bonus:balance';        // —á–∏—Å–ª–æ, ‚Ç¥
  const LS_HISTORY = 'rn:bonus:history';        // [{type:'km', route, date, km, credit}]
  const LS_FEE_VOUCHER = 'rn:svcfee:voucher';   // {amount:25, createdAt}

  // demo safe init (–æ—Å—Ç–∞–≤–∏—Ç –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
  const getBalance = () => Number(localStorage.getItem(LS_BALANCE) || '0');
  const setBalance = v => localStorage.setItem(LS_BALANCE, String(Math.max(0, Math.round(v))));
  const getHistory = () => { try { return JSON.parse(localStorage.getItem(LS_HISTORY)||'[]'); } catch(_) { return []; } };
  const setHistory = arr => localStorage.setItem(LS_HISTORY, JSON.stringify(arr));
  const getVoucher = () => { try { return JSON.parse(localStorage.getItem(LS_FEE_VOUCHER)||'null'); } catch(_) { return null; } };
  const setVoucher = v => localStorage.setItem(LS_FEE_VOUCHER, JSON.stringify(v));
  const clearVoucher = () => localStorage.removeItem(LS_FEE_VOUCHER);

  // ----- RENDER -----
  function render(){
    // –±–∞–ª–∞–Ω—Å
    document.getElementById('balance').textContent = getBalance() + ' ‚Ç¥';

    // —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–±–æ—Ä 25
    const voucher = getVoucher();
    document.getElementById('feeBadge').style.display = (voucher && voucher.amount>=25) ? 'inline-grid' : 'none';

    // —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    const hist = getHistory().filter(x => x.type==='km');
    const trips = hist.length;
    const km = hist.reduce((s,x)=>s+(x.km||0),0);
    document.getElementById('stTrips').textContent = trips;
    document.getElementById('stKm').textContent = (km||0) + ' –∫–º';
    document.getElementById('comment').textContent = commentFor(km, trips);

    // –∏—Å—Ç–æ—Ä–∏—è
    const box = document.getElementById('history');
    box.innerHTML = '';
    if (!hist.length) {
      box.innerHTML = '<div class="empty">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π. –ü–æ–µ–∑–¥–∏ ‚Äî –∏ –±–æ–Ω—É—Å—ã –ø–æ—è–≤—è—Ç—Å—è üòâ</div>';
    } else {
      hist.slice().reverse().forEach(x=>{
        const div = document.createElement('div');
        div.className='entry';
        div.innerHTML = `
          <div>
            <div><strong>${x.route}</strong> ‚Ä¢ ${x.km} –∫–º</div>
            <div class="sub">${x.date||''}</div>
          </div>
          <div>+${x.credit} ‚Ç¥</div>
        `;
        box.appendChild(div);
      });
      // –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å —Å–µ—Ä–≤—Å–±–æ—Ä–∞ ‚Äî –ø–æ–∫–∞–∂–µ–º —Å—Ç—Ä–æ–∫—É –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–≤–µ—Ä—Ö—É
      if (voucher && voucher.amount>=25) {
        const info = document.createElement('div');
        info.className='entry';
        const d = new Date(voucher.createdAt||Date.now()).toLocaleDateString('ru-RU');
        info.innerHTML = `
          <div>
            <div><strong>–ü–µ—Ä–µ–Ω–æ—Å —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞</strong></div>
            <div class="sub">${d}</div>
          </div>
          <div>25 ‚Ç¥</div>
        `;
        box.prepend(info);
      }
    }
  }

  // –≤–µ—Å—ë–ª—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É
  function commentFor(km, trips){
    if (km < 100) return '–ù—É —á—Ç–æ, –Ω–∞—á–∞–ª–æ—Å—å! üöÄ';
    if (km < 500) return '–•–æ—Ä–æ—à–∏–π —Å—Ç–∞—Ä—Ç, —Ç–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! üí™';
    if (km < 1000) return '–ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–µ—Ä–∂–∏—à—å —Ç–µ–º–ø! üòâ';
    if (km < 2000) return '–¢—ã –∫–∞–∫ –ª–µ—Ç—á–∏–∫ —É–∂–µ! ‚úàÔ∏è';
    if (trips >= 20) return '20+ –ø–æ–µ–∑–¥–æ–∫ ‚Äî —É–≤–∞–∂–µ–Ω–∏–µ! üôå';
    return '–ö–∞—Ç–∏—à—å —É–≤–µ—Ä–µ–Ω–Ω–æ! üõû';
  }

  // –≤—ã—Å–æ—Ç–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -> CSS var(--nav-h)
  (function setNavHeight(){
    const nav = document.getElementById('nav');
    const apply = ()=> document.documentElement.style.setProperty('--nav-h', (nav?.offsetHeight||92) + 'px');
    apply(); addEventListener('resize', apply);
  })();

  // –†–µ–Ω–¥–µ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  render();

  // ---- –ü–†–ò–ú–ï–ß–ê–ù–ò–ï –ü–û –ò–ù–¢–ï–ì–†–ê–¶–ò–ò ----
  // –ö–æ–≥–¥–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–ª–∞—á–µ–Ω–æ, –Ω–æ –ø–æ–µ–∑–¥–∫–∞ —Å–æ—Ä–≤–∞–Ω–∞ (–æ—Ç–º–µ–Ω–∞ –∏–ª–∏ —Å–º–µ–Ω–∞ –ø–æ–µ–∑–¥–∫–∏),
  // —Å–æ–∑–¥–∞–π –≤–∞—É—á–µ—Ä —Ç–∞–∫:
  //   setVoucher({ amount:25, createdAt: Date.now() })
  // –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±—Ä–æ–Ω–∏/–æ–ø–ª–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—è–π –≤–∞—É—á–µ—Ä –∏, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –Ω–µ –≤–∑–∏–º–∞–π 25 ‚Ç¥,
  // –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–æ–≤–æ–π –±—Ä–æ–Ω–∏ ‚Äî –æ—á–∏—Å—Ç–∏: clearVoucher()
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–°–æ–∑–¥–∞—Ç—å –ø–æ–µ–∑–¥–∫—É ‚Äî RideNow</title>
<style>
  :root{
    --ink:#eaf2ff; --muted:#a6b5cc; --stroke:rgba(255,255,255,.18);
    --glass1:rgba(255,255,255,.10); --glass2:rgba(255,255,255,.06);
    --g1:#b7a7ff; --g2:#8bd6c9;
    --dock-h:64px;
    --dock-safe: calc(var(--dock-h) + env(safe-area-inset-bottom, 0px));
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:#0b0f12;color:var(--ink);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    /* —á—Ç–æ–±—ã –¥–æ–∫-–Ω–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∞ –∫–æ–Ω—Ç–µ–Ω—Ç */
    padding-bottom: var(--dock-safe);
  }
  .bg:before{
    content:"";position:fixed;inset:0;z-index:-1;
    background:
      radial-gradient(60% 55% at 18% 10%, rgba(183,167,255,.22), transparent 60%),
      radial-gradient(60% 55% at 82% 88%, rgba(139,214,201,.20), transparent 60%),
      linear-gradient(#0b0f12,#0b0f12);
    filter:saturate(120%);
  }

  .card{width:min(880px,96vw);margin:22px auto;border-radius:22px;border:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--glass1),var(--glass2));
    box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.22);
    backdrop-filter:blur(14px) saturate(140%);
  /* keep card scrollable and above bottom dock on small screens */
  max-height: calc(100vh - var(--dock-safe) - 24px);
  overflow: auto; -webkit-overflow-scrolling: touch;
  }
  .inner{padding:18px}

  /* —Ç–æ–ø–±–∞—Ä */
  .topbar{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:8px}
  .iconbtn{
    height:36px;padding:0 12px;border-radius:12px;border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    color:var(--ink);font-weight:800;cursor:pointer;display:flex;align-items:center;gap:6px;text-decoration:none
  }
  .brand{display:flex;gap:8px;align-items:center;font-weight:900;opacity:.95}
  .brand a{color:inherit;text-decoration:none}
  .dot{width:8px;height:8px;border-radius:50%;background:linear-gradient(180deg,#9de9d7,#b7a7ff)}

  h1{margin:8px 0 14px;font-size:28px}

  .block{margin:12px 0 14px;padding:12px;border-radius:16px;border:1px solid var(--stroke);
    background:linear-gradient(180deg,var(--glass1),var(--glass2))}
  .block h3{margin:2px 4px 10px;font-size:16px;opacity:.9}

  .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

  .pill{
    display:flex;align-items:center;gap:10px;min-height:48px;padding:0 12px;border-radius:999px;
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
    border:1px solid var(--stroke); box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
    min-width:0;
  }
  .pill input{flex:1;min-width:0;background:transparent;border:0;outline:0;color:var(--ink);font-size:16px}
  .tiny{font-size:13px;color:var(--muted)}

  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
    font-size:14px;display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
  .chip.sel{box-shadow:0 0 0 2px #8bd6c9 inset}

  .inline-stats{display:flex;gap:8px;min-width:0;flex-wrap:wrap}
  .stat-pill{display:flex;align-items:center;gap:8px;padding:0 10px;min-height:40px;border-radius:999px;
    border:1px solid var(--stroke);background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));
    min-width:0;max-width:100%}
  .stat-pill .v{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:24px}

  .photos{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .ph{height:110px;border-radius:14px;border:1px solid var(--stroke);overflow:hidden;
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));display:grid;place-items:center;color:#92a0b5}
  .ph img{width:100%;height:100%;object-fit:cover}

  .preview{border-radius:16px;border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    padding:12px}
  .row{display:flex;justify-content:space-between;align-items:center;gap:10px}
  .route{font-weight:900;font-size:18px}
  .price{font-weight:900;color:#0b0f12;background:linear-gradient(90deg,#b7ffa3,#84ffd7);
    padding:6px 12px;border-radius:12px}
  .driver{display:flex;gap:10px;align-items:center;margin-top:8px}
  .ava{width:40px;height:40px;border-radius:50%;overflow:hidden;background:#556}
  .ava img{width:100%;height:100%;object-fit:cover}
  .name{font-weight:800;display:flex;align-items:center;gap:6px}
  .ver{font-size:12px;padding:2px 6px;border-radius:8px;background:linear-gradient(90deg,#8bd6c9,#b7a7ff);color:#0b0f12;font-weight:800}
  .meta{display:flex;gap:12px;color:#a6b5cc;font-size:13px;margin-top:6px;flex-wrap:wrap}
  .amen-line{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .seat-dots{display:flex;gap:8px;margin-top:10px}
  .dot{width:14px;height:14px;border-radius:50%;background:#2a3340;border:1px solid var(--stroke)}
  .dot.free{background:#7fd6b8}

  .publish{height:54px;border-radius:16px;width:100%;border:0;cursor:pointer;font-weight:900;font-size:18px;color:#0b0f12;
    background:linear-gradient(90deg, var(--g1), var(--g2));box-shadow:0 10px 24px rgba(183,167,255,.25);margin-top:10px}

  /* –Ω–∏–∂–Ω—è—è –¥–æ–∫-–Ω–∞–≤–∏–≥–∞—Ü–∏—è ‚Äî –ü–†–ò–ë–ò–¢–ê –ö –ù–ò–ó–£, –Ω–µ –ª–µ–∑–µ—Ç –Ω–∞ —Å–µ—Ä–µ–¥–∏–Ω—É */
  .rn-dock{
    position:fixed; left:0; right:0; bottom:0;
    display:flex; gap:10px; justify-content:center; flex-wrap:nowrap;
    padding:8px 10px calc(8px + env(safe-area-inset-bottom, 0px));
    height: var(--dock-h);
    background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.06));
    border-top:1px solid rgba(255,255,255,.18);
    backdrop-filter:blur(10px);
    z-index:1000;
  }
  .rn-dock .wrap{
    width:min(880px,96vw);
    display:flex; gap:10px; justify-content:space-between;
  }
  .rn-item{
    flex:1 1 auto; text-align:center;
    padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.18);
    color:#eaf2ff;text-decoration:none;font-weight:800;white-space:nowrap;
  }
  .rn-item{min-height:48px;display:inline-flex;align-items:center;justify-content:center}
  /* hide dock when input is focused on small screens (prevent keyboard overlap) */
  .rn-dock.hide{transform:translateY(110%);transition:transform .18s ease;pointer-events:none;opacity:0}
  .rn-item[aria-current="page"], .rn-item:hover{background:rgba(255,255,255,.08)}

  @media (max-width:640px){
    .grid-3{grid-template-columns:1fr}
    .grid-2{grid-template-columns:1fr}
    .inline-stats{flex-wrap:wrap}
  /* slightly larger touch targets on very small screens */
  .pill{min-height:52px;padding:0 14px}
  .publish{height:56px;font-size:20px}
  }
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>

<main class="card">
  <div class="inner">
    <!-- —Ç–æ–ø–±–∞—Ä -->
    <div class="topbar">
      <a class="iconbtn" href="search.html">‚Üê –ù–∞–∑–∞–¥</a>
      <div class="brand"><span class="dot"></span><a href="index.html" aria-label="–î–æ–º–æ–π">RideNow</a></div>
      <div style="display:flex;gap:8px">
        <a class="iconbtn" href="my-trips.html">–ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏</a>
        <!-- –∫–æ—à–µ–ª—å–∫–∞ –≤ —Ç–æ–ø–±–∞—Ä–µ —É –≤–æ–¥–∏—Ç–µ–ª—è –ù–ï–¢ -->
      </div>
    </div>

    <h1>–°–æ–∑–¥–∞—Ç—å –ø–æ–µ–∑–¥–∫—É</h1>

    <!-- –ú–∞—Ä—à—Ä—É—Ç -->
    <section class="block">
      <h3>–ú–∞—Ä—à—Ä—É—Ç</h3>
      <div class="grid-3" style="align-items:center">
        <label class="pill"><span>üü¢</span><input id="from" placeholder="–û—Ç–∫—É–¥–∞ (–≥–æ—Ä–æ–¥/—É–ª–∏—Ü–∞)" autocomplete="off"></label>
        <div class="stat-pill" title="–≤ –¥–æ—Ä–æ–≥–µ">
          <span>‚è±Ô∏è</span><span class="v" id="etaText">–≤ –¥–æ—Ä–æ–≥–µ ‚Äî</span>
        </div>
        <label class="pill"><span>üü†</span><input id="to" placeholder="–ö—É–¥–∞ (–≥–æ—Ä–æ–¥/—É–ª–∏—Ü–∞)" autocomplete="off"></label>
      </div>
      <div class="grid-3" style="margin-top:10px">
        <label class="pill"><span>üìÖ</span><input id="date" type="date"></label>
        <label class="pill"><span>‚è∞</span><input id="time" type="time" value="08:30"></label>
        <label class="pill"><span>ü™ë</span><input id="seats" type="number" min="1" max="3" value="2" style="width:5ch"><span class="tiny">–º–µ—Å—Ç–∞</span></label>
      </div>
      <div class="grid-3" style="margin-top:10px">
        <label class="pill"><span>üí≥</span><input id="price" type="number" min="0" value="550" style="width:7ch"><span class="tiny">‚Ç¥ –∑–∞ –º–µ—Å—Ç–æ</span></label>
        <div class="stat-pill"><span>üõ£</span><span class="v" id="kmText">–∫–º ‚Äî</span></div><div class="stat-pill"><span>üìç</span><span class="v" id="arriveText">–ø—Ä–∏–±—ã—Ç–∏–µ ‚Äî</span></div>
      </div>
      <div class="tiny" style="margin-top:6px">* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –∏ ETA —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∫–æ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ¬´–û—Ç–∫—É–¥–∞¬ª, ¬´–ö—É–¥–∞¬ª –∏ –≤—Ä–µ–º—è –≤—ã–µ–∑–¥–∞.</div>
      <div class="tiny" style="margin-top:8px">
        <a id="openMap" href="#" style="color:#cfe9ff;text-decoration:none;border-bottom:1px dotted #cfe9ff">üìç –û—Ç–∫—Ä—ã—Ç—å –º–∞—Ä—à—Ä—É—Ç –≤ Google Maps</a>
      </div>
    </section>

    <!-- –ó–∞–±—Ä–∞—Ç—å –∏–∑ –¥–æ–º–∞ -->
    <section class="block">
      <h3>–ó–∞–±—Ä–∞—Ç—å –∏–∑ –¥–æ–º–∞</h3>
      <label class="pill" style="justify-content:space-between">
        <span>‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω –∑–∞ –¥–æ–ø–ª–∞—Ç—É (—Å—É–º–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ–∑–∂–µ)</span>
        <input id="pickupToggle" type="checkbox" checked>
      </label>
    </section>

    <!-- –£–¥–æ–±—Å—Ç–≤–∞ -->
    <section class="block">
      <h3>–£–¥–æ–±—Å—Ç–≤–∞ (—Å–∞–ª–æ–Ω)</h3>
      <div id="amenChips" class="chips">
        <div class="chip" data-key="climate">‚ùÑÔ∏è –ö–ª–∏–º–∞—Ç</div>
        <div class="chip" data-key="rear2">üßç‚Äç‚ôÄÔ∏èüßç‚Äç‚ôÄÔ∏è –¢–æ–ª—å–∫–æ 2 —Å–∑–∞–¥–∏</div>
        <div class="chip" data-key="smokeNo">üö≠ –ù–µ–∫—É—Ä—è—â–∏–π —Å–∞–ª–æ–Ω</div>
        <div class="chip" data-key="vapeOk">üí® –≠–ª–µ–∫—Ç—Ä–æ–Ω–∫–∏ OK</div>
        <div class="chip" data-key="pet">üêæ –° –∂–∏–≤–æ—Ç–Ω—ã–º–∏</div>
        <div class="chip" data-key="kid">üçº –° —Ä–µ–±—ë–Ω–∫–æ–º</div>
        <div class="chip" data-key="chargeYes">üîå –ó–∞—Ä—è–¥–∫–∞ –µ—Å—Ç—å</div>
      </div>

      <h3 style="margin-top:12px">–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞</h3>
      <div id="atmChips" class="chips">
        <div class="chip" data-key="music">üéß –ú—É–∑—ã–∫–∞</div>
        <div class="chip" data-key="talk">üí¨ –û–±—â–µ–Ω–∏–µ</div>
        <div class="chip" data-key="calm">üåø –°–ø–æ–∫–æ–π–Ω–∞—è –µ–∑–¥–∞</div>
        <div class="chip" data-key="fast">‚ö°Ô∏è –ë—ã—Å—Ç—Ä–∞—è –µ–∑–¥–∞</div>
        <div class="chip" data-key="noTalk">ü§´ –ù–µ –æ–±—â–∞—Ç—å—Å—è</div>
        <div class="chip" data-key="charge">üîå –ó–∞—Ä—è–¥–∫–∞</div>
      </div>
    </section>

    <!-- –§–æ—Ç–æ –∞–≤—Ç–æ (–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è) -->
    <section class="block">
      <h3>–§–æ—Ç–æ –∞–≤—Ç–æ (–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è)</h3>
      <div class="photos">
        <div class="ph"><img id="ph_ext" alt=""></div>
        <div class="ph"><img id="ph_front" alt=""></div>
        <div class="ph"><img id="ph_rear" alt=""></div>
      </div>
      <div class="tiny" style="margin-top:6px">* –ë–µ—Ä—ë–º –∏–∑ localStorage: <code>car_ext</code>, <code>car_front</code>, <code>car_rear</code>. –ï—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä.</div>
    </section>

    <!-- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–∞–∫ –≤ –ø–æ–∏—Å–∫–µ -->
    <section class="block">
      <h3>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
      <div class="preview" id="preview">
        <div class="row">
          <div class="route" id="pv_route">–ú–∞—Ä—à—Ä—É—Ç</div>
          <div class="price" id="pv_price">0 ‚Ç¥</div>
        </div>
        <div class="driver">
          <div class="ava"><img id="pv_ava" alt=""></div>
          <div>
            <div class="name">–ü–∞–≤–µ–ª <span class="ver">–ø—Ä–æ–≤–µ—Ä–µ–Ω</span></div>
            <div class="meta" id="pv_meta">
              <span>‚è∞ ‚Äî</span><span>üõ£ ‚Äî –∫–º</span><span>üßç ‚Äî –º–µ—Å—Ç</span>
            </div>
          </div>
        </div>
        <div class="amen-line" id="pv_amen"></div>
        <div class="photos" style="margin-top:8px">
          <div class="ph"><img id="pv_ext" alt=""></div>
          <div class="ph"><img id="pv_front" alt=""></div>
          <div class="ph"><img id="pv_rear" alt=""></div>
        </div>
        <div class="seat-dots" id="pv_seats">
          <div class="dot free"></div><div class="dot free"></div><div class="dot"></div>
        </div>
      </div>
      <button class="publish" id="publishBtn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    </section>
  </div>
</main>

<!-- –Ω–∏–∂–Ω—è—è –¥–æ–∫-–Ω–∞–≤–∏–≥–∞—Ü–∏—è (–ø—Ä–∏–±–∏—Ç–∞, —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω–æ–π –¥–ª—è iOS) -->
<nav class="rn-dock" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
  <div class="wrap">
    <a href="search.html" class="rn-item">–ü–æ–∏—Å–∫</a>
    <a href="my-trips.html" class="rn-item">–ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏</a>
    <a href="driver-create-trip.html" class="rn-item" aria-current="page">–°–æ–∑–¥–∞—Ç—å</a>
    <a href="wallet.html" class="rn-item">–ö–æ—à–µ–ª—ë–∫</a>
    <a href="profile-driver.html" class="rn-item">–ü—Ä–æ—Ñ–∏–ª—å</a>
  </div>
</nav>

<script>
/* === mobile UX helpers: hide bottom dock when keyboard/input is active === */
(function(){
  const dock = document.querySelector('.rn-dock');
  if(!dock) return;
  let isSmall = ()=> window.matchMedia('(max-width:640px)').matches;
  let blurTimer = null;
  document.addEventListener('focusin', (e)=>{
    const t = e.target;
    if(!t) return;
    if(isSmall() && (t.tagName==='INPUT' || t.tagName==='TEXTAREA' || t.isContentEditable)){
      dock.classList.add('hide');
    }
  });
  document.addEventListener('focusout', (e)=>{
    if(!isSmall()) return;
    // delay restore to allow keyboard to dismiss
    clearTimeout(blurTimer);
    blurTimer = setTimeout(()=> dock.classList.remove('hide'), 220);
  });
  // when navigation item clicked, make sure dock is visible again
  dock.addEventListener('click', ()=> dock.classList.remove('hide'));
})();

/* ===== helpers ===== */const $  = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

/* chips toggle */
function chipToggle(wrapSel){
  $$(wrapSel+' .chip').forEach(c=>{
    c.addEventListener('click',()=>{ 
      c.classList.toggle('sel');
      refreshPreview();
    });
  });
}
chipToggle('#amenChips');
chipToggle('#atmChips');

/* ===== –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∏–∑ localStorage (–ø—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è) ===== */
function loadCarPhotos(){
  const ph = (k, id)=> {
    const v = localStorage.getItem(k);
    const el=$(id);
    if(v){ el.src=v; el.parentElement.style.color=''; el.parentElement.style.display=''; }
    else { el.removeAttribute('src'); el.parentElement.textContent='–Ω–µ—Ç —Ñ–æ—Ç–æ'; }
  };
  ph('car_ext','#ph_ext'); ph('car_front','#ph_front'); ph('car_rear','#ph_rear');
  // –ø—Ä–µ–≤—å—é
  ['ext','front','rear'].forEach(t=>{
    const v = localStorage.getItem('car_'+t);
    const el = $('#pv_'+t);
    if(v){ el.src=v; el.parentElement.style.color=''; el.parentElement.style.display=''; }
    else { el.removeAttribute('src'); el.parentElement.textContent='–Ω–µ—Ç —Ñ–æ—Ç–æ'; }
  });
  // –∞–≤–∞—Ç–∞—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  const ava = localStorage.getItem('driver_avatar');
  if (ava) $('#pv_ava').src = ava;
}
loadCarPhotos();

/* ===== mock –≥–µ–æ: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≥–æ—Ä–æ–¥–æ–≤ ===== */
const GEO = {
  "–∫–∏–µ–≤":[50.4501,30.5234],
  "—Ç–µ—Ä–µ–º–∫–∏":[50.3723,30.4524],
  "–æ–¥–µ—Å—Å–∞":[46.4825,30.7233],
  "–ª—å–≤–æ–≤":[49.8397,24.0297],
  "–∂–∏—Ç–æ–º–∏—Ä":[50.2547,28.6587],
  "–¥–Ω–µ–ø—Ä":[48.4647,35.0462],
  "—Å—É–º—ã":[50.9077,34.7981],
  "—Ö–∞—Ä—å–∫–æ–≤":[49.9935,36.2304]
};
function toCoord(s){
  if(!s) return null;
  const k = s.trim().toLowerCase();
  for (const name in GEO){ if (k.includes(name)) return GEO[name]; }
  return null;
}
function haversine(a,b){
  const R=6371; // km
  const toRad=x=>x*Math.PI/180;
  const dLat=toRad(b[0]-a[0]), dLon=toRad(b[1]-a[1]);
  const aa=Math.sin(dLat/2)**2+Math.cos(toRad(a[0]))*Math.cos(toRad(b[0]))*Math.sin(dLon/2)**2;
  return R*2*Math.atan2(Math.sqrt(aa),Math.sqrt(1-aa));
}

/* ===== –≤—ã—á–∏—Å–ª–µ–Ω–∏—è ETA/–∫–º –∏ –ø—Ä. ===== */
function computeGeo(){
  const a = toCoord($('#from').value);
  const b = toCoord($('#to').value);
  if(!a || !b) {
    $('#kmText').textContent='–∫–º ‚Äî';
    $('#etaText').textContent='–≤ –¥–æ—Ä–æ–≥–µ ‚Äî';
    $('#arriveText').textContent='–ø—Ä–∏–±—ã—Ç–∏–µ ‚Äî';
    return null;
  }
  const km = Math.round(haversine(a,b));
  $('#kmText').textContent = km+' –∫–º';

  // –≥—Ä—É–±–∞—è –º–æ–¥–µ–ª—å –≤—Ä–µ–º–µ–Ω–∏: 75 –∫–º/—á + 10% –Ω–∞ –≥–æ—Ä–æ–¥/–≤—ã–µ–∑–¥—ã
  const hours = km/75 * 1.1;
  const h = Math.floor(hours);
  const m = Math.round((hours-h)*60);
  $('#etaText').textContent = `–≤ –¥–æ—Ä–æ–≥–µ ${h}—á ${String(m).padStart(2,'0')}–º`;

  // –ø—Ä–∏–±—ã—Ç–∏–µ –ø–æ –≤—ã–µ–∑–¥—É
  const t = $('#time').value || '08:30';
  let [sh, sm] = t.split(':').map(Number);
  const depart = new Date(); depart.setHours(sh ?? 8, sm ?? 30, 0, 0);
  const arrive = new Date(depart.getTime() + hours*60*60*1000);
  const ah = String(arrive.getHours()).padStart(2,'0');
  const am = String(arrive.getMinutes()).padStart(2,'0');
  $('#arriveText').textContent = `–ø—Ä–∏–±—ã—Ç–∏–µ ${ah}:${am}`;

  // –ø—Ä–µ–≤—å—é
  $('#pv_meta').innerHTML = `<span>‚è∞ ${t} ‚Üí ${ah}:${am}</span><span>üõ£ ${km} –∫–º</span><span>üßç ${$('#seats').value||'-'} –º–µ—Å—Ç</span>`;
  return { km, departTime: t, arrive: `${ah}:${am} `};
}
['from','to','time'].forEach(id=>$('#'+id).addEventListener('input',()=>{computeGeo();refreshPreview();}));
$('#date').addEventListener('change',refreshPreview);
$('#seats').addEventListener('input',refreshPreview);

/* ===== –ø—Ä–µ–≤—å—é –∫–∞—Ä—Ç–æ—á–∫–∏ ===== */
function refreshPreview(){
  const fromVal = ($('#from').value || '').trim()||  '‚Äî';
  const toVal   = ($('#to').value || '').trim() ||   '‚Äî';
  $('#pv_route').textContent = `${fromVal} ‚Üí ${toVal}`;
  $('#pv_price').textContent = `${$('#price').value||0} ‚Ç¥`;
  computeGeo();

  // —É–¥–æ–±—Å—Ç–≤–∞ (—Å–∞–ª–æ–Ω + –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞)
  const pickedAmen = [...$('#amenChips .chip.sel'), ...$('#atmChips .chip.sel')]
    .map(c=>c.textContent.trim());
  $('#pv_amen').innerHTML = pickedAmen.map(t=>`<div class="chip" style="cursor:default">${t}</div>`).join('');

  // –º–µ—Å—Ç–∞
  const seats = Math.max(1, Math.min(3, +($('#seats').value||1)));
  const dots = [0,1,2].map(i=>`<div class="dot ${i<seats?'free':''}"></div>`).join('');
  $('#pv_seats').innerHTML = dots;
}
['price'].forEach(id=>$('#'+id).addEventListener('input',refreshPreview));
refreshPreview();

/* ===== –æ—Ç–∫—Ä—ã—Ç—å –≤ Google Maps ===== */
$('#openMap').addEventListener('click', (e)=>{
  e.preventDefault();
  const A = encodeURIComponent($('#from').value || '');
  const B = encodeURIComponent($('#to').value   || '');
  if(!A || !B) return alert('–£–∫–∞–∂–∏—Ç–µ ¬´–û—Ç–∫—É–¥–∞¬ª –∏ ¬´–ö—É–¥–∞¬ª.');
  window.open(`https://www.google.com/maps/dir/?api=1&origin=${A}&destination=${B}&travelmode=driving`, '_blank');
});

/* ===== –ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ localStorage –∏ –≤–µ–¥—ë–º –≤ ¬´–ú–æ–∏ –ø–æ–µ–∑–¥–∫–∏¬ª ===== */
$('#publishBtn').addEventListener('click',()=>{
  const from = ($('#from').value || '').trim();
  const to   = ($('#to').value   || '').trim();
  if(!from || !to){ alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ ¬´–û—Ç–∫—É–¥–∞¬ª –∏ ¬´–ö—É–¥–∞¬ª.'); return; }

  const geo = computeGeo() || {};
  const trip = {
    id: 't_'+Date.now(),
    from, to,
    date: $('#date').value || null,
    time: $('#time').value || null,
    seats: Math.max(1, Math.min(3, +($('#seats').value||1))),
    price: +($('#price').value||0),
    km: geo.km ?? null,
    arrive: geo.arrive ?? null,
    pickupEnabled: $('#pickupToggle').checked, // —Å–æ–≥–ª–∞—Å–µ–Ω –∑–∞ –¥–æ–ø–ª–∞—Ç—É
    amen:  [...$('#amenChips .chip.sel')].map(c=>c.dataset.key || c.textContent),
    atmos: [...$('#atmChips  .chip.sel')].map(c=>c.dataset.key || c.textContent),
    photos: {
      ext: localStorage.getItem('car_ext')   || null,
      front: localStorage.getItem('car_front') || null,
      rear: localStorage.getItem('car_rear')   || null
    },
    driver: {
      name:   localStorage.getItem('driver_name')  || '–ü–∞–≤–µ–ª',
      avatar: localStorage.getItem('driver_avatar')|| null,
      car:    localStorage.getItem('driver_car')   || 'Toyota Camry',
      plate:  localStorage.getItem('driver_plate') || 'AA1234BB',
      rating: 4.0
    },
    status: 'published'
  };

  const key='rn_trips';
  const list = JSON.parse(localStorage.getItem(key) || '[]');
  list.unshift(trip);
  localStorage.setItem(key, JSON.stringify(list));

  location.href = 'my-trips.html';
});
</script>
</body>
</html>